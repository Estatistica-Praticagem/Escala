PROMPT FINAL ‚Äî AJUSTE CIR√öRGICO DO START (OTIMIZADO PARA IA)
PAPEL DA IA

Voc√™ atuar√° como engenheiro de software s√™nior, com foco em:

ajustes cir√∫rgicos

preserva√ß√£o de comportamento existente

respeito absoluto a regras duras

zero refatora√ß√£o desnecess√°ria

CONTEXTO T√âCNICO

Existe um script grande e funcional que gera escala mensal de funcion√°rios.

Caracter√≠sticas fixas do sistema:

M√™s completo deve ser escalado

4 turnos fixos por dia: 00H, 06H, 12H, 18H

Exatamente 2 funcion√°rios por turno

Funcion√°rios EXP e AUX

Regras fora do START j√° funcionam corretamente e N√ÉO devem ser alteradas

PROBLEMA IDENTIFICADO (CLARO E CONCRETO)

Na primeira semana do m√™s (START) ocorrem dois problemas inaceit√°veis:

Funcion√°rio sendo escalado em mais de um turno no mesmo dia

Funcion√°rio ultrapassando 6 dias consecutivos de trabalho sem um dia inteiro de folga, burlando o limite via troca de turno

Esses problemas n√£o existem nas escalas reais da empresa e precisam ser eliminados.

OBJETIVO DO AJUSTE

Corrigir exclusivamente o START, garantindo:

estabilidade desde o dia 1

aus√™ncia total de ‚Äúpipocar‚Äù

impossibilidade de burlar regras duras

preserva√ß√£o do funcionamento atual fora do START

‚ö†Ô∏è N√ÉO reescrever o algoritmo inteiro
‚ö†Ô∏è N√ÉO alterar l√≥gica fora da primeira semana
‚ö†Ô∏è N√ÉO refatorar por est√©tica

REGRA DURA GLOBAL (OBRIGAT√ìRIA)
üîí UNICIDADE DI√ÅRIA (SEM EXCE√á√ïES)

Um funcion√°rio pode trabalhar em NO M√ÅXIMO 1 turno por dia.

Esta regra:

√© hard constraint

deve ser aplicada antes de qualquer escolha

deve valer:

no START

fora do START

em fallback

em relaxamento de regras

N√ÉO pode ser violada sob nenhuma circunst√¢ncia

REGRA DURA GLOBAL (OBRIGAT√ìRIA)
üîí LIMITE DE DIAS CONSECUTIVOS

Nenhum funcion√°rio pode trabalhar mais de 6 dias consecutivos sem pelo menos 1 dia inteiro de folga.

Troca de turno n√£o √© folga

Trabalhar em outro turno n√£o reseta sequ√™ncia

Esta regra deve ser imposs√≠vel de burlar

CONCEITO-CHAVE DO AJUSTE
üß± START ORIENTADO A BLOCO

O START n√£o deve ser resolvido apenas dia a dia.

Durante a primeira semana, o algoritmo deve considerar blocos m√≠nimos est√°veis de trabalho.

DEFINI√á√ÉO DE BLOCO

Um BLOCO possui as seguintes caracter√≠sticas:

criado quando o funcion√°rio entra pela primeira vez no m√™s

associado a um √∫nico turno

possui um tamanho m√≠nimo alvo (ex.: 3 dias consecutivos)

existe somente durante o START

N√ÉO substitui o modelo baseado em dias fora do START

REGRAS DO BLOCO (APENAS NO START)
üîπ Regra 1 ‚Äî Cria√ß√£o do Bloco

Quando um funcion√°rio √© escalado pela primeira vez no START:

cria-se automaticamente um bloco

o bloco fica vinculado ao turno inicial

define-se um contador de dias restantes

üîπ Regra 2 ‚Äî Bloqueio Total Enquanto o Bloco Estiver Ativo

Enquanto o bloco n√£o estiver fechado:

o funcion√°rio:

N√ÉO pode trocar de turno

N√ÉO pode ser usado em outro turno

N√ÉO pode ser realocado

N√ÉO pode ‚Äúpipocar‚Äù

ele deve ser tratado como obrigat√≥rio naquele turno

üîπ Regra 3 ‚Äî Encerramento do Bloco

Quando o bloco atinge seu tamanho m√≠nimo:

o bloco √© encerrado

o funcion√°rio retorna ao fluxo normal

regras existentes e scores continuam valendo

o restante do m√™s segue inalterado

ESCOPO EXATO DO QUE PODE SER ALTERADO

‚úî Criar estados auxiliares m√≠nimos (ex.: mapa de blocos, controle di√°rio)
‚úî Inserir verifica√ß√µes de regra dura
‚úî Ajustar l√≥gica somente no START

‚ùå N√ÉO converter o sistema inteiro para blocos
‚ùå N√ÉO alterar score global
‚ùå N√ÉO mudar pesos
‚ùå N√ÉO mexer no balanceamento do m√™s
‚ùå N√ÉO refatorar fun√ß√µes fora do necess√°rio

PRIORIDADE ABSOLUTA NA IMPLEMENTA√á√ÉO

Se houver conflito entre:

score

fallback

aleatoriedade

ou regra dura

üëâ A REGRA DURA SEMPRE VENCE.

RESULTADO ESPERADO (CRIT√âRIO DE SUCESSO)

Ap√≥s o ajuste:

nenhum funcion√°rio aparece em dois turnos no mesmo dia

nenhum funcion√°rio ultrapassa 6 dias consecutivos sem folga

a primeira semana fica est√°vel

o comportamento replica as escalas reais da empresa

o restante do m√™s permanece inalterado
